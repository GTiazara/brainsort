<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jeu de Tri de Nombres</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body id="body"
    class="min-h-screen flex flex-col items-center bg-gray-50 text-gray-800 p-6 transition-colors duration-500">

    <h1 class="text-3xl sm:text-4xl font-bold text-blue-600 mt-4 mb-2">üß† Jeu de Tri de Nombres</h1>
    <p class="text-center text-lg mb-4">
        Clique sur les nombres <strong>dans l‚Äôordre correct</strong> le plus vite possible !
    </p>

    <!-- Settings Panel -->
    <div id="settings"
        class="w-full max-w-md bg-white p-4 rounded-xl shadow-md space-y-4 mb-6 transition-colors duration-500">
        <div>
            <label class="block font-semibold">Nombre d‚Äô√©l√©ments :</label>
            <select id="numCount" class="w-full mt-1 border-gray-300 rounded-md p-2">
                <option value="random">Al√©atoire (7‚Äì10)</option>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
            </select>
        </div>

        <div>
            <label class="block font-semibold">Difficult√© :</label>
            <select id="difficulty" class="w-full mt-1 border-gray-300 rounded-md p-2">
                <option value="50">Facile (1‚Äì50)</option>
                <option value="100" selected>Moyen (1‚Äì100)</option>
                <option value="999">Difficile (1‚Äì999)</option>
            </select>
        </div>

        <div>
            <label class="block font-semibold">Ordre √† suivre :</label>
            <select id="order" class="w-full mt-1 border-gray-300 rounded-md p-2">
                <option value="asc">Croissant</option>
                <option value="desc">D√©croissant</option>
            </select>
        </div>

        <div class="flex items-center gap-2">
            <input id="showTime" type="checkbox" class="w-4 h-4" checked />
            <label for="showTime" class="font-semibold">Afficher le chronom√®tre</label>
        </div>

        <div>
            <label class="block font-semibold">Th√®me / Couleur :</label>
            <select id="themeMode" class="w-full mt-1 border-gray-300 rounded-md p-2">
                <option value="light" selected>Light</option>
                <option value="dark">Dark</option>
                <option value="random">Random Palette</option>
            </select>
        </div>

        <div class="flex items-center gap-2">
            <input id="challengeMode" type="checkbox" class="w-4 h-4" />
            <label for="challengeMode" class="font-semibold">Mode Challenge (Countdown)</label>
        </div>
        <div id="challengeTimeContainer" class="hidden">
            <label class="block font-semibold mt-2">Temps limite (secondes) :</label>
            <input type="number" id="challengeTime" class="w-full border-gray-300 rounded-md p-2" value="30" min="5"
                max="120" />
        </div>

        <button id="start-btn"
            class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-lg w-full transition">
            D√©marrer le jeu
        </button>
    </div>

    <!-- Timer -->
    <div id="timer-container" class="hidden mb-4">
        <span class="text-lg font-semibold">‚è± Temps : </span>
        <span id="timer" class="text-2xl font-bold text-blue-600">0.00 s</span>
    </div>

    <!-- Game Area -->
    <div id="numbers" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 w-full max-w-md mt-2"></div>

    <!-- Message -->
    <div id="message" class="text-center text-xl mt-6 font-medium"></div>

    <!-- Result Card -->
    <div id="result-card"
        class="hidden mt-6 bg-white shadow-lg rounded-xl p-6 text-center space-y-4 transition-colors duration-500">
        <div class="text-2xl font-bold text-green-600">‚úÖ Bravo !</div>
        <div id="final-time" class="text-3xl font-extrabold text-blue-600">0.00 s</div>
        <div class="flex justify-center gap-4 mt-4">
            <button id="retry-btn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg">üîÅ Rejouer</button>
            <button id="back-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg">‚öôÔ∏è
                Param√®tres</button>
        </div>
    </div>

    <!-- Sound Effects -->
    <audio id="click-sound" src="click.wav"></audio>
    <audio id="success-sound" src="success.wav"></audio>
    <audio id="fail-sound" src="fail.wav"></audio>

    <script>
        const settings = {
            numCount: document.getElementById("numCount"),
            difficulty: document.getElementById("difficulty"),
            order: document.getElementById("order"),
            showTime: document.getElementById("showTime"),
            themeMode: document.getElementById("themeMode"),
            challengeMode: document.getElementById("challengeMode"),
            challengeTime: document.getElementById("challengeTime")
        };

        const numbersContainer = document.getElementById("numbers");
        const message = document.getElementById("message");
        const startBtn = document.getElementById("start-btn");
        const timerEl = document.getElementById("timer");
        const timerBox = document.getElementById("timer-container");
        const resultCard = document.getElementById("result-card");
        const finalTimeEl = document.getElementById("final-time");
        const retryBtn = document.getElementById("retry-btn");
        const backBtn = document.getElementById("back-btn");
        const body = document.getElementById("body");

        const clickSound = document.getElementById("click-sound");
        const successSound = document.getElementById("success-sound");
        const failSound = document.getElementById("fail-sound");

        let numbers = [];
        let expected = 0;
        let startTime = null;
        let sorted = [];
        let timerInterval = null;
        let isChallenge = false;
        let remainingTime = 0;

        settings.challengeMode.addEventListener("change", () => {
            document.getElementById("challengeTimeContainer").style.display = settings.challengeMode.checked ? "block" : "none";
        });

        function startGame() {
            message.textContent = "";
            numbersContainer.innerHTML = "";
            expected = 0;
            clearInterval(timerInterval);
            timerInterval = null;
            resultCard.classList.add("hidden");
            startTime = null;

            // Theme
            applyTheme(settings.themeMode.value);

            // Challenge mode
            isChallenge = settings.challengeMode.checked;
            remainingTime = isChallenge ? parseInt(settings.challengeTime.value) : 0;

            // Parameters
            let count = settings.numCount.value === "random" ? 7 + Math.floor(Math.random() * 4) : parseInt(settings.numCount.value);
            const maxNum = parseInt(settings.difficulty.value);
            const order = settings.order.value;

            numbers = Array.from({ length: count }, () => Math.floor(Math.random() * maxNum) + 1);
            sorted = [...numbers].sort((a, b) => a - b);
            if (order === "desc") sorted.reverse();
            numbers.sort(() => Math.random() - 0.5);

            numbers.forEach(num => {
                const btn = document.createElement("button");
                btn.textContent = num;
                btn.className = `
      number w-full text-center bg-white border-2 border-blue-500 text-blue-600
      rounded-xl py-4 text-2xl font-bold transition active:scale-95
      hover:bg-blue-500 hover:text-white shadow-sm
    `;
                btn.onclick = (event) => checkNumber(event, num);
                numbersContainer.appendChild(btn);
            });

            // Timer
            if (settings.showTime.checked) {
                timerBox.classList.remove("hidden");
                if (isChallenge) startChallengeTimer();
                else startTime = Date.now(), timerInterval = setInterval(updateTimer, 100);
            } else timerBox.classList.add("hidden");

            settingsPanelVisibility(false);
        }

        function applyTheme(mode) {
            if (mode === "light") {
                body.className = "min-h-screen flex flex-col items-center bg-gray-50 text-gray-800 p-6 transition-colors duration-500";
            } else if (mode === "dark") {
                body.className = "min-h-screen flex flex-col items-center bg-gray-900 text-gray-100 p-6 transition-colors duration-500";
            } else if (mode === "random") {
                const r = Math.floor(Math.random() * 200), g = Math.floor(Math.random() * 200), b = Math.floor(Math.random() * 200);
                body.style.backgroundColor = `rgb(${r},${g},${b})`; body.style.color = "white";
            }
        }

        function startChallengeTimer() {
            timerEl.textContent = `${remainingTime.toFixed(2)} s`;
            timerInterval = setInterval(() => {
                remainingTime -= 0.1;
                if (remainingTime <= 0) { remainingTime = 0; clearInterval(timerInterval); failGame(); }
                timerEl.textContent = `${remainingTime.toFixed(2)} s`;
            }, 100);
        }

        function updateTimer() {
            if (!startTime) return;
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            timerEl.textContent = `${elapsed} s`;
        }

        function checkNumber(event, num) {
            clickSound.play().catch(() => { });
            if (num === sorted[expected]) {
                expected++;
                event.target.classList.add("invisible");
                if (expected === sorted.length) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    successSound.play().catch(() => { });
                    const time = isChallenge ? (parseFloat(settings.challengeTime.value) - remainingTime).toFixed(2) : ((Date.now() - startTime) / 1000).toFixed(2);
                    showResult(time);
                }
            } else {
                clearInterval(timerInterval);
                timerInterval = null;
                message.innerHTML = `<span class="text-red-600">‚ùå Mauvais ordre ! Red√©marrage...</span>`;
                setTimeout(startGame, 1200);
            }
        }

        function failGame() {
            failSound.play().catch(() => { });
            message.innerHTML = `<span class="text-red-600 font-bold">‚è∞ Temps √©coul√© ! Vous avez perdu.</span>`;
            numbersContainer.innerHTML = "";
        }

        function showResult(time) {
            timerBox.classList.add("hidden");
            numbersContainer.innerHTML = "";
            message.textContent = "";
            finalTimeEl.textContent = `${time} s`;
            resultCard.classList.remove("hidden");
        }

        function settingsPanelVisibility(show) {
            document.getElementById("settings").style.display = show ? "block" : "none";
            if (show) timerBox.classList.add("hidden");
        }

        retryBtn.addEventListener("click", startGame);
        backBtn.addEventListener("click", () => { resultCard.classList.add("hidden"); settingsPanelVisibility(true); });
        startBtn.addEventListener("click", startGame);
    </script>
</body>

</html>